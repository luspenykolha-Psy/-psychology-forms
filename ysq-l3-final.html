<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YSQ-L3 — Опитувальник схем Янга</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f7f4ef;
    --white: #ffffff;
    --ink: #1e1e1e;
    --muted: #888680;
    --line: #e5e0d8;
    --teal: #3d7a72;
    --teal-light: #c8deda;
    --teal-dark: #2a5650;
    --warm: #c4895a;
    --warm-light: #f0dece;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Jost', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
  }

  /* Texture overlay */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 0;
  }

  .wrap {
    max-width: 680px;
    margin: 0 auto;
    padding: 48px 24px 100px;
    position: relative; z-index: 1;
  }

  /* ── Header ── */
  .site-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 40px;
    animation: fadeDown .7s ease both;
  }
  .site-header .dot { width:6px;height:6px;border-radius:50%;background:var(--teal); }
  .site-header span {
    font-size: 12px; letter-spacing: .18em; text-transform: uppercase;
    color: var(--teal-dark); font-weight: 500;
  }

  /* ── Block header (shown during quiz) ── */
  #quizHeader {
    margin-bottom: 32px;
    animation: fadeDown .6s ease both;
  }

  .block-meta {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 16px;
  }
  .block-tag {
    font-size: 11px; font-weight: 500; letter-spacing: .12em;
    text-transform: uppercase; color: var(--teal);
    background: var(--teal-light); padding: 4px 12px; border-radius: 20px;
  }
  .block-counter { font-size: 13px; color: var(--muted); }

  /* Progress */
  .progress-bar {
    height: 2px; background: var(--line); border-radius: 1px; overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--teal), var(--teal-dark));
    border-radius: 1px;
    transition: width .5s cubic-bezier(.4,0,.2,1);
  }

  /* ── Schema title card ── */
  .schema-card {
    background: var(--white);
    border-radius: 20px;
    padding: 28px 32px;
    margin-bottom: 20px;
    border-top: 3px solid var(--teal);
    box-shadow: 0 2px 20px rgba(0,0,0,.05);
  }
  .schema-domain {
    font-size: 11px; letter-spacing: .1em; text-transform: uppercase;
    color: var(--warm); margin-bottom: 6px; font-weight: 500;
  }
  .schema-name {
    font-family: 'Playfair Display', serif;
    font-size: clamp(20px, 4vw, 26px);
    font-weight: 500; line-height: 1.3; color: var(--ink);
  }

  /* ── Instruction banner ── */
  .instruction-banner {
    background: var(--teal-light);
    border-radius: 12px;
    padding: 14px 20px;
    margin-bottom: 24px;
    font-size: 13px; line-height: 1.65; color: var(--teal-dark);
  }

  /* ── Questions ── */
  .questions-list { display: flex; flex-direction: column; gap: 14px; }

  .q-card {
    background: var(--white);
    border-radius: 16px;
    padding: 20px 24px;
    border: 1.5px solid transparent;
    box-shadow: 0 1px 12px rgba(0,0,0,.04);
    transition: border-color .25s, box-shadow .25s;
    animation: fadeUp .4s ease both;
  }
  .q-card.answered { border-color: var(--teal-light); }
  .q-card.error {
    border-color: #e05a5a !important;
    background: linear-gradient(135deg, white 0%, rgba(224,90,90,0.05) 100%);
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }
  .error-hint {
    font-size: 12px; color: #e05a5a; margin-top: 10px; font-weight: 500;
  }

  .q-num {
    font-size: 11px; color: var(--muted); letter-spacing: .08em;
    margin-bottom: 8px; font-weight: 500;
  }
  .q-text {
    font-size: 15px; line-height: 1.65; color: var(--ink);
    margin-bottom: 16px;
  }

  /* Scale buttons */
  .scale-row {
    display: flex; gap: 6px;
  }
  .scale-btn {
    flex: 1;
    display: flex; flex-direction: column; align-items: center;
    gap: 4px;
    padding: 10px 4px;
    background: var(--bg);
    border: 1.5px solid var(--line);
    border-radius: 10px;
    cursor: pointer;
    transition: all .2s ease;
    font-family: 'Jost', sans-serif;
  }
  .scale-btn:hover { background: var(--teal-light); border-color: var(--teal); }
  .scale-btn.selected {
    background: var(--teal);
    border-color: var(--teal-dark);
    color: white;
  }
  .scale-num {
    font-size: 18px; font-weight: 500; line-height: 1;
  }
  .scale-label {
    font-size: 9px; text-align: center; line-height: 1.3;
    color: var(--muted); letter-spacing: .04em;
  }
  .scale-btn.selected .scale-label { color: rgba(255,255,255,.8); }
  .scale-btn.selected .scale-num { color: white; }

  @media (max-width: 480px) {
    .scale-label { display: none; }
    .scale-btn { padding: 12px 4px; }
    .scale-num { font-size: 16px; }
  }

  /* ── Navigation ── */
  .nav-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 32px;
  }

  .btn-back {
    display: flex; align-items: center; gap: 6px;
    background: none; border: 1.5px solid var(--line);
    padding: 12px 24px; border-radius: 50px;
    font-family: 'Jost', sans-serif; font-size: 14px;
    color: var(--muted); cursor: pointer;
    transition: all .2s;
  }
  .btn-back:hover { border-color: var(--teal); color: var(--teal); }
  .btn-back:disabled { opacity: 0.3; cursor: not-allowed; }

  .btn-next {
    display: flex; align-items: center; gap: 8px;
    background: var(--teal-dark); color: white;
    border: none; padding: 14px 36px; border-radius: 50px;
    font-family: 'Jost', sans-serif; font-size: 15px; font-weight: 500;
    cursor: pointer;
    transition: all .25s;
    box-shadow: 0 4px 18px rgba(42,86,80,.25);
  }
  .btn-next:hover { background: var(--teal); transform: translateY(-1px); box-shadow: 0 6px 24px rgba(42,86,80,.3); }
  .btn-next:disabled { background: var(--line); color: var(--muted); cursor: not-allowed; transform: none; box-shadow: none; }

  .nav-hint { font-size: 12px; color: var(--muted); margin-top: 10px; text-align: center; }

  /* Missed highlight */
  .q-card.missed {
    border-color: #e8a87c;
    background: linear-gradient(135deg, white 0%, #fdf3ec 100%);
    animation: shake .4s ease;
  }
  .missed-label {
    display: none;
    font-size: 11px; color: var(--warm); font-weight: 500;
    margin-bottom: 6px; letter-spacing: .05em;
  }
  .q-card.missed .missed-label { display: block; }

  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }

  /* Scale legend */
  .scale-legend {
    display: flex; justify-content: space-between;
    margin-top: 6px; padding: 0 2px;
  }
  .scale-legend span {
    font-size: 10px; color: var(--muted); line-height: 1.3;
  }
  .scale-legend span:last-child { text-align: right; }

  /* ── Intro screen ── */
  #introScreen {
    text-align: center;
    animation: fadeUp .8s ease both;
  }
  #introScreen h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(30px, 7vw, 48px);
    font-weight: 400; line-height: 1.2;
    margin-bottom: 16px;
  }
  #introScreen h1 em { font-style: italic; color: var(--teal-dark); }
  #introScreen p {
    font-size: 15px; line-height: 1.75; color: var(--muted);
    max-width: 460px; margin: 0 auto 32px;
  }

  .intro-info {
    display: grid; grid-template-columns: 1fr 1fr 1fr;
    gap: 12px; margin-bottom: 36px;
  }
  .info-box {
    background: var(--white); border-radius: 14px; padding: 18px 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,.05);
  }
  .info-num {
    font-family: 'Playfair Display', serif;
    font-size: 28px; color: var(--teal-dark); margin-bottom: 4px;
  }
  .info-label { font-size: 12px; color: var(--muted); }

  .name-input-wrap { margin-bottom: 28px; }
  .name-input-wrap label {
    display: block; font-size: 13px; color: var(--muted);
    margin-bottom: 8px; letter-spacing: .05em;
  }
  .name-input {
    width: 100%; padding: 14px 20px;
    border: 1.5px solid var(--line); border-radius: 12px;
    font-family: 'Jost', sans-serif; font-size: 16px;
    background: var(--white); color: var(--ink);
    transition: border-color .2s;
    outline: none;
  }
  .name-input:focus { border-color: var(--teal); }

  .btn-start {
    display: inline-flex; align-items: center; gap: 10px;
    background: var(--teal-dark); color: white;
    border: none; padding: 18px 52px; border-radius: 50px;
    font-family: 'Jost', sans-serif; font-size: 16px; font-weight: 500;
    cursor: pointer;
    box-shadow: 0 4px 24px rgba(42,86,80,.3);
    transition: all .25s;
  }
  .btn-start:hover { background: var(--teal); transform: translateY(-2px); }

  /* ── Thank you screen ── */
  #thankScreen {
    display: none; text-align: center;
    animation: fadeUp .8s ease both;
  }
  .thank-icon {
    width: 72px; height: 72px; border-radius: 50%;
    background: var(--teal-light);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 24px; font-size: 32px;
  }
  #thankScreen h2 {
    font-family: 'Playfair Display', serif;
    font-size: 32px; margin-bottom: 12px;
  }
  #thankScreen p { font-size: 15px; color: var(--muted); line-height: 1.7; }

  /* ── Animations ── */
  @keyframes fadeDown {
    from { opacity:0; transform:translateY(-16px); }
    to   { opacity:1; transform:translateY(0); }
  }
  @keyframes fadeUp {
    from { opacity:0; transform:translateY(16px); }
    to   { opacity:1; transform:translateY(0); }
  }

  .hidden { display: none !important; }
</style>
</head>
<body>
<div class="wrap">

  <div class="site-header">
    <div class="dot"></div>
    <span>Психологічна практика</span>
    <div class="dot"></div>
  </div>

  <!-- ══ INTRO ══ -->
  <div id="introScreen">
    <h1>Опитувальник<br><em>схем Янга</em></h1>
    <p>YSQ‑L3 · 232 твердження · Шкала 1–6<br>Заповнення займає приблизно 25–35 хвилин</p>

    <div class="intro-info">
      <div class="info-box">
        <div class="info-num">232</div>
        <div class="info-label">твердження</div>
      </div>
      <div class="info-box">
        <div class="info-num">18</div>
        <div class="info-label">схем</div>
      </div>
      <div class="info-box">
        <div class="info-num">5</div>
        <div class="info-label">доменів</div>
      </div>
    </div>

    <div class="name-input-wrap">
      <label>Ваше ім'я (або ініціали)</label>
      <input class="name-input" id="clientName" type="text" placeholder="Наприклад: Марія К." maxlength="60">
    </div>

    <button class="btn-start" onclick="startQuiz()">
      Розпочати
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </button>
  </div>

  <!-- ══ QUIZ ══ -->
  <div id="quizScreen" class="hidden">

    <div id="quizHeader">
      <div class="block-meta">
        <span class="block-tag" id="blockTag">Домен</span>
        <span class="block-counter" id="blockCounter">Блок 1 з 18</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="instruction-banner">
      Нижче наводяться твердження. Прочитайте кожне і оцініть, наскільки добре воно описує Вас. Оберіть відповідь від <strong>1</strong> (абсолютно не відповідає мені) до <strong>6</strong> (досконало описує мене).
    </div>

    <div class="schema-card">
      <div class="schema-domain" id="schemaDomain"></div>
      <div class="schema-name" id="schemaName"></div>
    </div>

    <div class="questions-list" id="questionsList"></div>

    <div class="nav-row">
      <button class="btn-back" id="btnBack" onclick="prevBlock()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Назад
      </button>
      <button class="btn-next" id="btnNext" onclick="nextBlock()">
        <span id="btnNextLabel">Далі</span>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </button>
    </div>
    <div class="nav-hint" id="navHint">Дайте відповідь на всі твердження цього блоку</div>
  </div>

  <!-- ══ THANK YOU ══ -->
  <div id="thankScreen">
    <div class="thank-icon">✓</div>
    <h2>Дякуємо!</h2>
    <p>Ваші відповіді збережено.<br>Психолог розгляне результати та обговорить їх з вами на сесії.</p>
  </div>

</div>

<script>
// ══════════════════════════════════════════
// GOOGLE SHEETS WEBHOOK URL
// Замініть цей рядок на свій Apps Script URL
// ══════════════════════════════════════════
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxTaoht8OxwOxxVkfiLGPTiWT36UhWLDqFGCi634STP3uhtMieEg_rSgyc7gNQ3jgdmsQ/exec';

// ══════════════════════════════════════════
// СТРУКТУРА YSQ-L3
// 18 схем згрупованих по 5 доменах
// ══════════════════════════════════════════
const domains = [
  { id: 'D1', name: 'Відчуженість та відторгнення' },
  { id: 'D2', name: 'Порушена автономія та здатність діяти' },
  { id: 'D3', name: 'Порушення меж' },
  { id: 'D4', name: 'Орієнтація на інших' },
  { id: 'D5', name: 'Надпильність та пригніченість' },
];

const schemas = [
  {
    id: 'ed', domain: 'D1',
    name: 'Покинутість / Нестабільність',
    questions: [
      { n: 1,  t: 'У моєму житті не було людей, які б розуміли і відповідали на мої емоційні потреби.' },
      { n: 2,  t: 'Я не отримував (-ла) достатньо любові та уваги.' },
      { n: 3,  t: 'Здебільшого, у мене не було нікого, хто б дав мені пораду, або підтримав емоційно.' },
      { n: 4,  t: 'Переважно у мене не було нікого, хто б турбувався про мене, з ким я б міг розділити свій внутрішній світ, хто б цікавився тим, що зі мною відбувається.' },
      { n: 5,  t: 'Більшу частину мого життя у мене не було нікого, хто б хотів мати зі мною близькі стосунки і проводити зі мною багато часу.' },
      { n: 6,  t: 'Здебільшого в мене не було нікого, хто б давав тепло, підтримку і любов.' },
      { n: 7,  t: 'Більшу частину мого життя я не відчував (-ла), що я є особливим (-ою) для когось.' },
      { n: 8,  t: 'Здебільшого в мене не було нікого, хто б справді слухав мене, розумів мене або був зацікавлений моїми справами чи почуттями.' },
      { n: 9,  t: 'Дуже рідко у моєму житті був хтось, хто міг би дати мені добру пораду чи підказку, коли я не був (-ла) впевнений (-а), що робити.' },
      { n: 10, t: 'Я переживаю, що люди, яких я люблю, скоро помруть, навіть якщо не має загроз їх здоров\'ю та благополуччю з медичної точки зору.' },
      { n: 11, t: 'Я помічаю, що «прилипаю» до близьких мені людей тому, що боюся, що вони покинуть мене.' },
      { n: 12, t: 'Я переживаю, що близькі мені люди покинуть/відкинуть мене.' },
      { n: 13, t: 'Я відчуваю, що мені не вистачає джерела стабільної емоційної підтримки.' },
      { n: 14, t: 'Я не вважаю, що важливі стосунки тривають довго, я очікую, що вони завершаться.' },
      { n: 15, t: 'Я почуваюся узалежним (-ою) від стосунку з людьми, які не можуть справді зобов\'язатися до тривалих, відповідальних стосунків зі мною.' },
      { n: 16, t: 'Зрештою, я все одно буду один (-на).' },
      { n: 17, t: 'Коли я відчуваю, що хтось, кого я люблю, віддаляється від мене, я впадаю у відчай.' },
      { n: 18, t: 'Інколи я настільки переживаю, що люди покинуть мене, що сам (-а) відкидаю їх.' },
      { n: 19, t: 'Я засмучуюсь, коли хтось залишає мене самого (-у), навіть на короткий проміжок часу.' },
      { n: 20, t: 'Я не можу розраховувати на людей, якщо вони не можуть бути постійно присутніми у моєму житті – регулярної присутності мені замало.' },
      { n: 21, t: 'Я не можу дозволити собі сильно зближуватись з іншими людьми тому, що я не впевнений (-а), що цей стосунок буде стійким і вони завжди будуть поруч.' },
      { n: 22, t: 'Виглядає так, що важливі люди в моєму житті завжди приходять і відходять.' },
      { n: 23, t: 'Я дуже переживаю, що люди, яких я люблю, знайдуть когось іншого, хто їм буде подобатись більше, ніж я, і покинуть мене.' },
      { n: 24, t: 'Близькі мені люди завжди були дуже непередбачуваними: в один момент вони поряд зі мною, привітні, а в інший – вони розгнівані, засмучені, егоцентричні і конфліктні.' },
      { n: 25, t: 'Я настільки потребую інших людей, що переживаю, що втрачу їх.' },
      { n: 26, t: 'Я не можу бути собою чи виявляти, що я насправді відчуваю, інакше важливі для мене люди покинуть мене.' },
    ]
  },
  {
    id: 'ab', domain: 'D1',
    name: 'Недовіра / Зловживання',
    questions: [
      { n: 27, t: 'Я вважаю, що люди мають намір використати мене задля власних потреб.' },
      { n: 28, t: 'Я часто відчуваю, що повинен (-на) захищати себе від інших.' },
      { n: 29, t: 'Я відчуваю, що не можу втрачати пильність в присутності інших людей, інакше вони навмисно зроблять мені боляче.' },
      { n: 30, t: 'Якщо хтось добре до мене ставиться, то я припускаю, що він/вона має якісь приховані наміри.' },
      { n: 31, t: 'Мене обов\'язково хтось зрадить, це лиш питання часу.' },
      { n: 32, t: 'Більшість людей думають тільки про себе.' },
      { n: 33, t: 'Я маю великі труднощі з довірою до людей.' },
      { n: 34, t: 'Я часто маю підозри щодо мотивів інших людей.' },
      { n: 35, t: 'Люди дуже рідко є чесними; вони зазвичай не є тими, за кого себе видають.' },
      { n: 36, t: 'Зазвичай я шукаю приховані мотиви у діях інших людей щодо мене.' },
      { n: 37, t: 'Якщо я думаю, що хтось збирається завдати мені болю, то намагаюся завдати болю першим (-ою).' },
      { n: 38, t: 'Як правило, я повинен (-на) ретельно перевірити людей перед тим, як зможу їм довіряти.' },
      { n: 39, t: 'Я влаштовую «перевірки» іншим людям, щоб переконатися в тому, що вони говорять правду і мають добрі наміри.' },
      { n: 40, t: 'Я живу за правилом «Контролюй інших, інакше вони контролюватимуть тебе».' },
      { n: 41, t: 'Я починаю злитись, коли думаю про те, як жорстоко зі мною поводилися люди в моєму житті.' },
      { n: 42, t: 'У моєму житті близькі мені люди використовували мене задля досягнення власних цілей чи задоволення власних потреб.' },
      { n: 43, t: 'Я зазнав (-ла) фізичного, емоційного або сексуального насильства збоку важливих людей в моєму житті.' },
    ]
  },
  {
    id: 'ma', domain: 'D1',
    name: 'Емоційна депривація',
    questions: [
      { n: 44, t: 'Я не такий (-а) як всі.' },
      { n: 45, t: 'Я абсолютно відрізняюсь від інших людей.' },
      { n: 46, t: 'Я нікому не належу; я самітник.' },
      { n: 47, t: 'Я почуваюся відчуженим (-ою) від інших людей.' },
      { n: 48, t: 'Я почуваюся ізольованим (-ою) і самотнім (-ньою).' },
      { n: 49, t: 'Я завжди почуваюся поза групою.' },
      { n: 50, t: 'Ніхто по-справжньому мене не розуміє.' },
      { n: 51, t: 'Моя сім\'я завжди відрізнялась від сімей навколо нас.' },
      { n: 52, t: 'Інколи я почуваюся інопланетянином.' },
      { n: 53, t: 'Якщо мене завтра не стане, то ніхто цього не помітить.' },
    ]
  },
  {
    id: 'si', domain: 'D1',
    name: 'Дефективність / Сором',
    questions: [
      { n: 54, t: 'Жоден (-на) чоловік/жінка, з якою я хочу бути, не зможе розвивати подальші стосунки і хотіти бути зі мною, якщо дізнається про мої недоліки і вади.' },
      { n: 55, t: 'Ніхто, хто мені дуже подобається, не залишився б поруч зі мною, якби пізнав мене справжнього (-ю).' },
      { n: 56, t: 'За своєю суттю я недосконалий (-а) і дефективний (-а).' },
      { n: 57, t: 'Немає значення скільки я стараюся, я відчуваю що мені не вдасться здобути достойного (-у) чоловіка/жінку, який (-а) би поважав мене і вважав (-ла) мене цінним (-ою).' },
      { n: 58, t: 'Я недостойний (-на) любові, поваги та уваги від інших.' },
      { n: 59, t: 'Я відчуваю, що я невартий (-а) любові.' },
      { n: 60, t: 'Я є людиною, яку неможливо прийняти такою, якою вона є – тож я не можу відкриватися перед іншими людьми.' },
      { n: 61, t: 'Якби люди дізналися про мої основні недоліки, то я не міг (могла) б дивитися їм в очі.' },
      { n: 62, t: 'Коли я подобаюся людям, то почуваюся так, ніби я їх обманую.' },
      { n: 63, t: 'Я часто помічаю, що мене тягне до людей, які критикують або відкидають мене.' },
      { n: 64, t: 'У мене є особисті таємниці і я не хочу, щоб близькі люди дізналися про них.' },
      { n: 65, t: 'Це моя вина, що батьки не любили мене достатньою мірою.' },
      { n: 66, t: 'Я не дозволяю людям пізнати мене справжнього (-ю).' },
      { n: 67, t: 'Один з найбільших страхів це той, що мої недоліки будуть виявлені.' },
      { n: 68, t: 'Я не можу зрозуміти, як хтось може мене любити.' },
    ]
  },
  {
    id: 'ds', domain: 'D2',
    name: 'Невдача',
    questions: [
      { n: 69, t: 'Майже нічого з того, що я роблю на роботі (чи в навчанні), я не роблю настільки добре, як це можуть зробити інші люди.' },
      { n: 70, t: 'Я некомпетентний (-а), коли мова йде про досягнення у праці чи навчанні.' },
      { n: 71, t: 'Інші люди є більш здібними від мене у сфері роботи (чи навчання) тому й вони можуть, на відміну від мене, досягнути у житті.' },
      { n: 72, t: 'Я невдаха.' },
      { n: 73, t: 'Я не настільки талановитий (-а) в роботі (чи навчанні), як інші люди.' },
      { n: 74, t: 'Я не настільки розумний (-а), як інші люди, якщо мова йде про роботу (чи навчання).' },
      { n: 75, t: 'Я почуваюся приниженим (-ою) через мої недоліки та невдачі на роботі (у навчанні).' },
      { n: 76, t: 'Мені часто соромно знаходитись поряд з іншими людьми, тому що я не рівня їм за тим, чого досяг у житті.' },
      { n: 77, t: 'Я часто порівнюю мої досягнення з досягненнями інших людей і відчуваю, що інші люди набагато успішніші за мене.' },
    ]
  },
  {
    id: 'fa', domain: 'D2',
    name: 'Залежність / Некомпетентність',
    questions: [
      { n: 78, t: 'Я не відчуваю, що здатний (-а) самостійно давати собі раду у повсякденному житті.' },
      { n: 79, t: 'Я потребую інших людей, щоб справлятися зі всім.' },
      { n: 80, t: 'Я не відчуваю, що можу вправлятися самостійно з вимогами щоденного життя.' },
      { n: 81, t: 'Я переконаний (-а), що інші люди краще можуть потурбуватися про мене, ніж я сам (-а) про себе.' },
      { n: 82, t: 'Мені важко братися за нові завдання поза роботою, якщо поряд не буде когось, хто б мене супроводжував.' },
      { n: 83, t: 'Я вважаю себе особою, залежною від інших, якщо мова йде про щоденне функціонування.' },
      { n: 84, t: 'Я псую все, за що беруся, навіть поза межами роботи (навчання).' },
      { n: 85, t: 'Я нездібний (-а) у більшості сфер мого життя.' },
      { n: 86, t: 'Якщо я покладатимусь на власний розсуд у повсякденних ситуаціях, то прийму неправильне рішення.' },
      { n: 87, t: 'Мені не вистачає практичних знань та вмінь необхідних для щоденного життя.' },
      { n: 88, t: 'Я не можу покладатися на власні судження в щоденних ситуаціях.' },
      { n: 89, t: 'Я не маю впевненості у своїй здатності вирішувати щоденні проблеми, які виникають.' },
      { n: 90, t: 'Я відчуваю, що потребую когось, на кого можу покластися, хто б давав мені поради у практичних питаннях.' },
      { n: 91, t: 'Я відчуваю себе більше дитиною, ніж дорослим, коли йдеться про виконання повсякденних обов\'язків.' },
      { n: 92, t: 'Для мене давати собі раду самостійно з викликами та завданнями щоденного життя є надто великим стресом.' },
    ]
  },
  {
    id: 'di', domain: 'D2',
    name: 'Вразливість до шкоди або хвороби',
    questions: [
      { n: 93,  t: 'Я не можу позбутися відчуття, що має трапитись щось погане.' },
      { n: 94,  t: 'Я відчуваю, що катастрофа (природня, кримінальна, фінансова або зі здоров\'ям) може трапитись в будь-який момент.' },
      { n: 95,  t: 'Я переживаю, що можу стати безхатченком, опинитися на вулиці.' },
      { n: 96,  t: 'Я переживаю, що на мене хтось нападе.' },
      { n: 97,  t: 'Я вдаюся до значних запобіжних заходів, щоб уникнути хвороби чи травм, нещасних випадків.' },
      { n: 98,  t: 'Я переживаю, що у мене розвивається серйозна хвороба, навіть попри те, що нічого серйозного лікарі не виявили при обстеженні.' },
      { n: 99,  t: 'Я є лялива людина.' },
      { n: 100, t: 'Я занадто хвилююся про погані речі, які відбуваються у світі: злочини, забруднення навколишнього середовища і т.п.' },
      { n: 101, t: 'Я переживаю, що можу зійти з розуму.' },
      { n: 102, t: 'Я переживаю, що в мене буде панічна атака.' },
      { n: 103, t: 'Я часто переживаю, що в мене може бути серцевий напад або рак, навіть якщо для цього існують дуже незначні медичні підстави.' },
      { n: 104, t: 'Я відчуваю, що світ є небезпечним місцем.' },
    ]
  },
  {
    id: 'vu', domain: 'D2',
    name: 'Заплутана ідентичність / Недостатній розвиток Я',
    questions: [
      { n: 105, t: 'Я не був (-ла) в змозі відокремитися від батьків так, як це зробили інші люди мого віку.' },
      { n: 106, t: 'Як мої батьки, так і я, ми маємо тенденцію до того, щоб надмірно перейматися життям та проблемами одні одних.' },
      { n: 107, t: 'Мені та моїм батькам дуже важко приховувати інтимні подробиці одні від одних, не відчуваючи себе винними.' },
      { n: 108, t: 'Моїм батькам і мені потрібно розмовляти одні з одними майже щодня, інакше хтось з нас почуватиметься винним, враженим, розчарованим або самотнім.' },
      { n: 109, t: 'Я часто відчуваю, що не маю відокремленої ідентичності від моїх батьків чи від мого партнера.' },
      { n: 110, t: 'Я часто відчуваю, що мої батьки визначають моє життя – і я не маю власного.' },
      { n: 111, t: 'Мені дуже важко утримувати будь-яку дистанцію в стосунку з близькими мені людьми; мені складно в будь-який спосіб відчувати себе осібною людиною.' },
      { n: 112, t: 'Я настільки відчуваю себе пов\'язаним (-ою) з моїм партнером чи батьками, що мені важко відділити себе від них, визначити, ким я є сам по собі і чого хочу.' },
      { n: 113, t: 'Мені важко відокремити мою точку зору чи думку від точки зору моїх батьків чи партнера.' },
      { n: 114, t: 'Я часто відчуваю, що в стосунку з батьками чи моїм партнером не існує межі, яка би відділяла простір мого приватного життя – щодо них у мене немає жодних кордонів.' },
      { n: 115, t: 'Я відчуваю, що моїм батькам є або було б дуже боляче, якби я жив (-ла) своїм життям, далеко від них.' },
    ]
  },
  {
    id: 'eu', domain: 'D3',
    name: 'Покірність',
    questions: [
      { n: 116, t: 'Я дозволяю іншим людям, щоб було так, як вони хочуть, тому що я боюся наслідків.' },
      { n: 117, t: 'Я вважаю, що якщо я роблю те, що хочу, то цим самим просто напрошуюся на неприємності.' },
      { n: 118, t: 'Я думаю, що в мене немає вибору і я змушений (-а) задовольняти бажання інших, інакше вони мене відкинуть.' },
      { n: 119, t: 'У стосунках я надаю іншій особі право вирішального голосу у прийнятті рішень.' },
      { n: 120, t: 'Я завжди дозволяв (-ла) іншим приймати рішення за мене, тож я дійсно не знаю, чого хочу для себе.' },
      { n: 121, t: 'Я відчуваю, що важливі рішення в моєму житті не були справді прийняті мною.' },
      { n: 122, t: 'Я постійно намагаюся догодити людям, щоб вони мене не відкинули.' },
      { n: 123, t: 'Для мене є великою трудністю вимагати, щоб мої права поважали, а також, щоб зважали на мої почуття.' },
      { n: 124, t: 'Я невиразно виявляю людям своє незадоволення замість того, щоб прямо проявити свою злість чи незадоволення.' },
      { n: 125, t: 'Я прикладаю набагато більше зусиль, ніж інші люди, щоб уникнути прямої суперечки/конфронтації з іншими людьми.' },
    ]
  },
  {
    id: 'sb', domain: 'D4',
    name: 'Самопожертва',
    questions: [
      { n: 126, t: 'Я ставлю потреби інших вище від своїх, бо інакше я почуватимусь винним (-ою).' },
      { n: 127, t: 'Я почуваюся винним (-ою), коли засмучую або розчаровую інших.' },
      { n: 128, t: 'Я більше віддаю людям, ніж отримую взамін.' },
      { n: 129, t: 'Вкінці-кінців, зазвичай, на мене лягає турбота про близьких людей.' },
      { n: 130, t: 'Не існує майже нічого, чого б я не міг (могла) терпіти, якщо я когось люблю.' },
      { n: 131, t: 'Я є доброю людиною, тому що турбуюсь про інших більше, ніж про себе.' },
      { n: 132, t: 'На роботі я, зазвичай, добровільно виконую додаткові завдання в позаробочий час.' },
      { n: 133, t: 'Не має значення, наскільки я зайнятий (-а), я завжди знайду час для інших.' },
      { n: 134, t: 'Я можу жити на мінімальних засобах для існування, бо мої потреби дуже незначні.' },
      { n: 135, t: 'Я щасливий (-а) лише тоді, коли всі навколо мене щасливі.' },
      { n: 136, t: 'Я настільки зайнятий (-а) турботою про інших, що майже не маю часу для себе.' },
      { n: 137, t: 'Я завжди вислуховую проблеми інших.' },
      { n: 138, t: 'Мені комфортніше дарувати подарунки, ніж отримувати.' },
      { n: 139, t: 'Інші люди вважають, що я занадто багато роблю для інших, і недостатньо для себе.' },
      { n: 140, t: 'Незалежно від того, скільки я даю, я завжди відчуваю, що це недостатньо.' },
      { n: 141, t: 'Якщо я роблю те, що хочу, то почуваюся некомфортно.' },
      { n: 142, t: 'Мені дуже важко просити інших турбуватися про мої потреби.' },
    ]
  },
  {
    id: 'ss', domain: 'D4',
    name: 'Пошук схвалення / Пошук визнання',
    questions: [
      { n: 143, t: 'Я переживаю, що втрачу контроль над своїми діями.' },
      { n: 144, t: 'Я переживаю, що можу завдати комусь серйозної фізичної або емоційної шкоди, якщо мій гнів вийде з-під контролю.' },
      { n: 145, t: 'Я вважаю, що повинен (-на) контролювати свої емоції та імпульси, інакше трапиться щось погане.' },
      { n: 146, t: 'В мені є багато гніву і почуття образи, яких я не виявляю.' },
      { n: 147, t: 'Я занадто сором\'язливий (-а), щоб показувати свої позитивні почуття до інших (напр., прихильність, турботу).' },
      { n: 148, t: 'Мені соромно висловлювати свої почуття до інших.' },
      { n: 149, t: 'Мені важко бути теплим (-ою) і спонтанним (-ою).' },
      { n: 150, t: 'Я настільки контролюю себе, що люди думають, що я неемоційний (-а).' },
      { n: 151, t: 'Люди вважають мене емоційно скутим (-ою).' },
    ]
  },
  {
    id: 'ei', domain: 'D5',
    name: 'Негативізм / Песимізм',
    questions: [
      { n: 152, t: 'Я повинен (-на) бути найкращим (-ою) в тому, що роблю; «друге місце» неприйнятне для мене.' },
      { n: 153, t: 'Я намагаюся тримати все в ідеальному порядку.' },
      { n: 154, t: 'Я постійно мушу виглядати якнайкраще.' },
      { n: 155, t: 'Я намагаюся робити все якнайкраще; мені замало, щоб було просто «достатньо добре».' },
      { n: 156, t: 'Мені потрібно зробити стільки всього, що зовсім не залишається часу для відпочинку.' },
      { n: 157, t: 'Нічого з того, що я роблю, не є достатньо добрим; я завжди можу зробити краще.' },
      { n: 158, t: 'Я повинен (-на) виконувати всі свої обов\'язки.' },
      { n: 159, t: 'Я відчуваю на собі постійний тягар обов\'язків та справ, які маю завершити на належному рівні.' },
      { n: 160, t: 'Мої стосунки страждають, тому що я надто багато часу приділяю виконанню своїх обов\'язків.' },
      { n: 161, t: 'Я настільки хочу зробити все добре, а тому перепрацьовуюся, що це відображається на моєму здоров\'ї.' },
      { n: 162, t: 'Я часто жертвую своїм щастям та задоволенням, задля того, щоб довести справи до належного рівня виконання.' },
      { n: 163, t: 'Коли я помиляюсь, то заслуговую на сувору критику.' },
      { n: 164, t: 'Я не можу так легко звільнити себе від відповідальності чи пробачити собі свої помилки.' },
      { n: 165, t: 'Я дуже конкурентна особистість.' },
      { n: 166, t: 'Я надаю велике значення грошам і статусу.' },
      { n: 167, t: 'Судячи по моїй поведінці, я завжди повинен (-на) бути «номер один».' },
    ]
  },
  {
    id: 'us', domain: 'D5',
    name: 'Жорсткі стандарти / Надмірна критичність',
    questions: [
      { n: 168, t: 'Мені дуже важко прийняти відповідь «Ні», коли я когось про щось прошу.' },
      { n: 169, t: 'Мене часто злять і дратують ситуації, коли я не можу отримати те, чого хочу.' },
      { n: 170, t: 'Я є особливий (-а), і тому на мене не поширюються багато обмежень і заборон, які накладаються на інших людей.' },
      { n: 171, t: 'Я ненавиджу, коли мене обмежують або не дають мені робити те, що я хочу.' },
      { n: 172, t: 'Я вважаю, що не повинен (-на) дотримуватися певних правил чи норм так, як це роблять інші люди.' },
      { n: 173, t: 'Я вважаю, що те, що я можу запропонувати я, є ціннішим від того, що можуть запропонувати інші.' },
      { n: 174, t: 'Я, зазвичай, ставлю мої потреби вище від потреб інших.' },
      { n: 175, t: 'Я часто помічаю, що настільки зайнятий (-а) своїми справами, що не маю часу для друзів чи сім\'ї.' },
      { n: 176, t: 'Люди часто говорять мені, що я надмірно контролюю, в який виконуються завдання.' },
      { n: 177, t: 'Я дуже дратуюся, коли люди не роблять те, що я їх прошу.' },
      { n: 178, t: 'Я не можу терпіти, коли інші говорять мені, що робити.' },
    ]
  },
  {
    id: 'et', domain: 'D5',
    name: 'Недостатній самоконтроль / Самодисципліна',
    questions: [
      { n: 179, t: 'Мені надзвичайно важко припинити вживати алкоголь, курити, переїдати чи відмовитись від інших шкідливих звичок.' },
      { n: 180, t: 'Мені важко організувати себе, щоб завершити рутинне або нудне завдання.' },
      { n: 181, t: 'Я часто дозволяю собі проявити такі емоції чи імпульсивні реакції, які спричиняють мені проблеми або ранять інших людей.' },
      { n: 182, t: 'Якщо я не можу досягнути мети, то швидко розчаровуюся і відмовляюся від неї.' },
      { n: 183, t: 'Мені важко пожертвувати миттєвим задоволенням задля досягнення довготривалої мети.' },
      { n: 184, t: 'Часто буває так, що коли я починаю злитись, то вже не можу себе контролювати.' },
      { n: 185, t: 'Я маю схильність виконувати надто багато роботи, навіть якщо знаю, що для мене це погано.' },
      { n: 186, t: 'Я дуже швидко знуджуюся, втрачаю інтерес.' },
      { n: 187, t: 'Якщо виявляється, що завдання важче, я, зазвичай, не завершую його до кінця.' },
      { n: 188, t: 'Я не можу довго концентруватися на чомусь.' },
      { n: 189, t: 'Я не можу змушувати себе робити речі, які не приносять мені задоволення, навіть якщо я знаю, що це заради мого добра.' },
      { n: 190, t: 'Я виходжу з себе навіть через найменшу образу.' },
      { n: 191, t: 'Мені рідко вдавалося притримуватись мого рішення.' },
      { n: 192, t: 'Я майже ніколи не стримую себе від прояву моїх справжніх почуттів та емоцій, незалежно від того, чого мені це буде коштувати.' },
      { n: 193, t: 'Я часто дію імпульсивно, про що пізніше шкодую.' },
    ]
  },
  {
    id: 'is', domain: 'D4',
    name: 'Пошук схвалення / Визнання',
    questions: [
      { n: 194, t: 'Для мене важливо подобатись майже всім моїм знайомим.' },
      { n: 195, t: 'Я підлаштовуюсь під тих, з ким перебуваю для того, щоб більше їм подобатись.' },
      { n: 196, t: 'Я прикладаю великих зусиль для того, щоб мене прийняли, щоб мене поважали.' },
      { n: 197, t: 'Моя самооцінка переважно ґрунтується на думці інших людей про мене.' },
      { n: 198, t: 'Гроші і знайомства з важливими людьми додають мені почуття власної цінності.' },
      { n: 199, t: 'Я багато часу приділяю своєму зовнішньому вигляду, щоб люди оцінили мене.' },
      { n: 200, t: 'Досягнення є більш цінними для мене, якщо їх хтось помічає.' },
      { n: 201, t: 'Я настільки зосереджений (-на) на тому, щоб бути як всі, що інколи не знаю, ким я є.' },
      { n: 202, t: 'Мені важко ставити власні цілі, не беручи до уваги думку інших про мій вибір.' },
      { n: 203, t: 'Коли я думаю про важливі рішення в моєму житті, то бачу, що у їх прийнятті для мене було ключовим, щоби ці рішення були схвалені іншими людьми.' },
      { n: 204, t: 'Навіть якщо мені хтось не подобається, я все одно хочу подобатись тій особі.' },
      { n: 205, t: 'Я почуваюся менш важливим (-ою), якщо не отримую багато уваги від інших.' },
      { n: 206, t: 'Якщо я виступаю на засіданнях або якщо мене представлено на зборах, то я очікую схвалення і визнання.' },
      { n: 207, t: 'Похвала і компліменти дають мені відчуття цінності.' },
    ]
  },
  {
    id: 'as', domain: 'D5',
    name: 'Негативізм / Вразливість до помилок',
    questions: [
      { n: 208, t: 'Навіть якщо все йде добре, я думаю, що це тимчасово.' },
      { n: 209, t: 'Якщо стається щось добре, я хвилююсь, що після цього може статись щось погане.' },
      { n: 210, t: 'Неможливо бути надмірно ретельним; майже завжди щось піде не так.' },
      { n: 211, t: 'Незважаючи на те, як я працюю, я боюсь фінансового краху.' },
      { n: 212, t: 'Я хвилююсь, що неправильне рішення може призвести до катастрофи.' },
      { n: 213, t: 'Я часто надмірно переймаюся через незначні рішення, тому що думаю, що їх наслідки можуть бути дуже серйозними.' },
      { n: 214, t: 'Я почуваюся краще, коли подумки готую себе до того, що мені нічого не вийде, аніж робити щось, а потім бути розчарованим, якщо щось піде не так.' },
      { n: 215, t: 'Я концентруюся більше на негативних моментах та подіях життя, ніж на позитивних.' },
      { n: 216, t: 'Я більше песиміст, ніж оптиміст.' },
      { n: 217, t: 'Близькі мені люди вважають, що я надмірно за все переживаю.' },
      { n: 218, t: 'Якщо люди занадто захоплені чимось, мені стає незручно і я відчуваю, що маю застерегти їх про те, що щось може піти не так.' },
    ]
  },
  {
    id: 'np', domain: 'D5',
    name: 'Покарання',
    questions: [
      { n: 219, t: 'Якщо я роблю помилку, то заслуговую на покарання.' },
      { n: 220, t: 'Якщо я не стараюся з усіх сил, мені слід очікувати невдачі.' },
      { n: 221, t: 'Мені немає пробачення, якщо я зроблю помилку.' },
      { n: 222, t: 'Люди, які не виконують чесно свою частину роботи, повинні бути покарані.' },
      { n: 223, t: 'Здебільшого, я не приймаю виправдань інших. Вони просто не хочуть взяти на себе відповідальність і «заплатити» за наслідки.' },
      { n: 224, t: 'Якщо я не виконую роботу добре, то повинен (-на) постраждати від наслідків.' },
      { n: 225, t: 'Я часто думаю про помилки, які зробив (-ла), і відчуваю злість на себе.' },
      { n: 226, t: 'Коли люди роблять щось погане, мені важко сказати «я тобі пробачаю і давай забудемо про це».' },
      { n: 227, t: 'Я тримаю образу навіть після того, як людина попросила пробачення.' },
      { n: 228, t: 'Мене дратує, коли я бачу, що людині все дуже легко сходить з рук.' },
      { n: 229, t: 'Мене дратує, коли люди виправдовуються або звинувачують інших у своїх проблемах.' },
      { n: 230, t: 'Немає значення, чому я зробив (-ла) помилку; коли я роблю щось не так, я маю за це заплатити.' },
      { n: 231, t: 'Я часто собі докоряю за багато речей, які я зробив (-ла) не так.' },
      { n: 232, t: 'Я погана людина, яка заслуговує на покарання.' },
    ]
  },
];

// Domain mapping
const domainMap = {
  D1: 'Домен I · Відчуженість та відторгнення',
  D2: 'Домен II · Порушена автономія та здатність діяти',
  D3: 'Домен III · Порушення меж',
  D4: 'Домен IV · Орієнтація на інших',
  D5: 'Домен V · Надпильність та пригніченість',
};

const scaleLabels = ['Абсолютно\nне відповідає', 'В основному\nне відповідає', 'Більше вірно,\nніж невірно', 'В міру\nвідповідає', 'Переважно\nвідповідає', 'Досконало\nописує'];

// State
let clientName = '';
let currentBlock = 0;
let answers = {}; // { questionNumber: score }

function startQuiz() {
  clientName = document.getElementById('clientName').value.trim() || 'Анонімно';
  document.getElementById('introScreen').classList.add('hidden');
  document.getElementById('quizScreen').classList.remove('hidden');
  renderBlock(0);
}

function renderBlock(idx) {
  currentBlock = idx;
  const schema = schemas[idx];
  const total = schemas.length;

  // Header
  document.getElementById('blockTag').textContent = 'Домен ' + schema.domain.replace('D','');
  document.getElementById('blockCounter').textContent = `Блок ${idx + 1} з ${total}`;
  document.getElementById('progressFill').style.width = `${((idx) / total) * 100}%`;
  document.getElementById('schemaDomain').textContent = '';
  document.getElementById('schemaName').textContent = '';

  // Back button
  document.getElementById('btnBack').disabled = idx === 0;

  // Next button label
  document.getElementById('btnNextLabel').textContent = idx === total - 1 ? 'Завершити' : 'Далі';

  // Render questions
  const list = document.getElementById('questionsList');
  list.innerHTML = '';
  schema.questions.forEach((q, qi) => {
    const card = document.createElement('div');
    card.className = 'q-card' + (answers[q.n] !== undefined ? ' answered' : '');
    card.id = `qcard-${q.n}`;
    card.style.animationDelay = `${qi * 0.04}s`;

    let scaleHTML = [1,2,3,4,5,6].map(v => `
      <button class="scale-btn ${answers[q.n] === v ? 'selected' : ''}" 
              onclick="selectAnswer(${q.n}, ${v}, this)">
        <span class="scale-num">${v}</span>
        <span class="scale-label">${scaleLabels[v-1].replace('\n','<br>')}</span>
      </button>
    `).join('');

    card.innerHTML = `
      <div class="missed-label">⚠ Будь ласка, оберіть відповідь</div>
      <div class="q-num">Твердження ${q.n}</div>
      <div class="q-text">${q.t}</div>
      <div class="scale-row">${scaleHTML}</div>
      <div class="scale-legend">
        <span>1 — абсолютно не<br>відповідає мені</span>
        <span>6 — досконало<br>описує мене</span>
      </div>
    `;
    list.appendChild(card);
  });

  updateNextBtn();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function selectAnswer(qNum, val, btn) {
  answers[qNum] = val;
  // Update UI in this row
  btn.closest('.scale-row').querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  document.getElementById(`qcard-${qNum}`).classList.add('answered');
  updateNextBtn();
}

function updateNextBtn() {
  const schema = schemas[currentBlock];
  const allAnswered = schema.questions.every(q => answers[q.n] !== undefined);
  const btn = document.getElementById('btnNext');
  
  document.getElementById('navHint').textContent = allAnswered
    ? (currentBlock === schemas.length - 1 ? 'Всі відповіді надано — можна завершити' : 'Можна переходити до наступного блоку')
    : 'Дайте відповідь на всі твердження цього блоку';
}

function prevBlock() {
  if (currentBlock > 0) renderBlock(currentBlock - 1);
}

function nextBlock() {
  const schema = schemas[currentBlock];
  const missed = schema.questions.filter(q => answers[q.n] === undefined);
  if (missed.length > 0) {
    missed.forEach(q => {
      const card = document.getElementById(`qcard-${q.n}`);
      if (card) {
        card.classList.remove("missed");
        void card.offsetWidth;
        card.classList.add("missed");
        setTimeout(() => card.classList.remove("missed"), 2500);
      }
    });
    const firstCard = document.getElementById(`qcard-${missed[0].n}`);
    if (firstCard) firstCard.scrollIntoView({ behavior: "smooth", block: "center" });
    return;
  }
  if (currentBlock < schemas.length - 1) {
    renderBlock(currentBlock + 1);
  } else {
    submitResults();
  }
}

// ── Нормативна шкала інтерпретації (з бланку YSQ-L3) ──
const interpretationScale = {
  ed: { HB: 8,  CB: 30, BB: 54 },
  ab: { HB: 12, CB: 25, BB: 39 },  // до 102
  ma: { HB: 12, CB: 25, BB: 39 },  // до 102
  si: { HB: 8,  CB: 18, BB: 30 },
  ds: { HB: 12, CB: 25, BB: 39 },
  fa: { HB: 8,  CB: 18, BB: 30 },
  di: { HB: 12, CB: 25, BB: 39 },
  vu: { HB: 8,  CB: 18, BB: 30 },
  eu: { HB: 8,  CB: 18, BB: 30 },
  sb: { HB: 8,  CB: 18, BB: 30 },
  ss: { HB: 12, CB: 25, BB: 39 },
  ei: { HB: 8,  CB: 18, BB: 30 },
  us: { HB: 12, CB: 25, BB: 39 },
  et: { HB: 8,  CB: 18, BB: 30 },
  is: { HB: 12, CB: 25, BB: 39 },
  as: { HB: 12, CB: 25, BB: 39 },
  np: { HB: 8,  CB: 18, BB: 30 },
  pu: { HB: 12, CB: 25, BB: 39 },
};

function calcSchemaScore(schemaId, questions) {
  // Враховуються тільки відповіді 4, 5, 6
  // Сума = (кількість "4" × 4) + (кількість "5" × 5) + (кількість "6" × 6)
  let sum = 0;
  questions.forEach(q => {
    const val = answers[q.n];
    if (val >= 4) sum += val;
  });
  return sum;
}

function getInterpretation(schemaId, score) {
  const scale = interpretationScale[schemaId];
  if (score <= scale.HB) return 'Низький';
  if (score <= scale.CB) return 'Середній';
  if (score <= scale.BB) return 'Високий';
  return 'Дуже високий';
}

function submitResults() {
  // Правильний підрахунок по кожній схемі
  const schemaScores = {};
  const schemaInterpretations = {};
  schemas.forEach(s => {
    const score = calcSchemaScore(s.id, s.questions);
    schemaScores[s.id] = score;
    schemaInterpretations[s.id] = getInterpretation(s.id, score);
  });

  // Топ-3 схеми за балом
  const sorted = Object.entries(schemaScores).sort((a,b) => b[1]-a[1]);
  const top3 = sorted.slice(0,3).map(([id]) => {
    const s = schemas.find(s => s.id === id);
    return `${s.name} (${schemaScores[id]})`;
  }).join(', ');

  // Сирі відповіді по кожному питанню
  const rawByQuestion = {};
  schemas.forEach(s => {
    s.questions.forEach(q => {
      rawByQuestion[`П${q.n}`] = answers[q.n];
    });
  });

  const payload = {
    timestamp: new Date().toISOString(),
    name: clientName,
    questionnaire: 'YSQ-L3',
    // Бали по 18 схемах
    ed: schemaScores.ed, ab: schemaScores.ab, ma: schemaScores.ma,
    si: schemaScores.si, ds: schemaScores.ds, fa: schemaScores.fa,
    di: schemaScores.di, vu: schemaScores.vu, eu: schemaScores.eu,
    sb: schemaScores.sb, ss: schemaScores.ss, ei: schemaScores.ei,
    us: schemaScores.us, et: schemaScores.et, is: schemaScores.is,
    as: schemaScores.as, np: schemaScores.np, pu: schemaScores.pu,
    // Інтерпретації
    ed_i: schemaInterpretations.ed, ab_i: schemaInterpretations.ab,
    ma_i: schemaInterpretations.ma, si_i: schemaInterpretations.si,
    ds_i: schemaInterpretations.ds, fa_i: schemaInterpretations.fa,
    di_i: schemaInterpretations.di, vu_i: schemaInterpretations.vu,
    eu_i: schemaInterpretations.eu, sb_i: schemaInterpretations.sb,
    ss_i: schemaInterpretations.ss, ei_i: schemaInterpretations.ei,
    us_i: schemaInterpretations.us, et_i: schemaInterpretations.et,
    is_i: schemaInterpretations.is, as_i: schemaInterpretations.as,
    np_i: schemaInterpretations.np, pu_i: schemaInterpretations.pu,
    // Топ-3
    top3_schemas: top3,
    // Сирі відповіді
    raw: JSON.stringify(rawByQuestion),
  };

  // Show thank you immediately
  document.getElementById('quizScreen').classList.add('hidden');
  document.getElementById('thankScreen').style.display = 'block';
  document.getElementById('progressFill').style.width = '100%';

  // Send to Google Sheets
  if (SHEET_URL !== 'https://script.google.com/macros/s/AKfycbxTaoht8OxwOxxVkfiLGPTiWT36UhWLDqFGCi634STP3uhtMieEg_rSgyc7gNQ3jgdmsQ/exec') {
    fetch(SHEET_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    }).catch(err => console.error('Send error:', err));
  } else {
    console.log('Results (dev mode):', payload);
  }
}
</script>
</body>
</html>
