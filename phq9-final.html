<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHQ-9 — Опитувальник стану здоров'я</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --sage: #7a9e87;
    --sage-light: #c8ddd0;
    --sage-dark: #4a7059;
    --cream: #f5f0e8;
    --warm-white: #faf8f4;
    --charcoal: #2d2d2d;
    --muted: #8a8880;
    --accent: #c17f59;
    --accent-light: #f0dece;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--charcoal);
    min-height: 100vh;
    position: relative;
  }

  /* Decorative background */
  body::before {
    content: '';
    position: fixed;
    top: -200px; right: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(122,158,135,0.15) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -150px; left: -150px;
    width: 500px; height: 500px;
    background: radial-gradient(circle, rgba(193,127,89,0.1) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
    padding: 40px 24px 80px;
    position: relative;
    z-index: 1;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 48px;
    animation: fadeDown 0.8s ease both;
  }

  .logo-line {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 28px;
  }

  .logo-dot {
    width: 8px; height: 8px;
    background: var(--sage);
    border-radius: 50%;
  }

  .logo-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--sage-dark);
  }

  .header h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(28px, 6vw, 44px);
    font-weight: 500;
    line-height: 1.2;
    color: var(--charcoal);
    margin-bottom: 12px;
  }

  .header h1 em {
    font-style: italic;
    color: var(--sage-dark);
  }

  .header p {
    font-size: 15px;
    color: var(--muted);
    line-height: 1.7;
    max-width: 480px;
    margin: 0 auto;
  }

  /* Progress bar */
  .progress-wrap {
    margin-bottom: 40px;
    animation: fadeDown 0.8s 0.1s ease both;
  }

  .progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  .progress-label {
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 0.05em;
  }

  .progress-count {
    font-size: 13px;
    font-weight: 500;
    color: var(--sage-dark);
  }

  .progress-bar {
    height: 3px;
    background: var(--sage-light);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--sage), var(--sage-dark));
    border-radius: 2px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
  }

  /* Instruction card */
  .instruction-card {
    background: white;
    border-radius: 16px;
    padding: 24px 28px;
    margin-bottom: 32px;
    border-left: 3px solid var(--sage);
    box-shadow: 0 2px 20px rgba(0,0,0,0.06);
    animation: fadeDown 0.8s 0.15s ease both;
  }

  .instruction-card p {
    font-size: 15px;
    line-height: 1.75;
    color: var(--charcoal);
  }

  .instruction-card strong {
    color: var(--sage-dark);
  }

  /* Questions */
  .questions-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .question-card {
    background: white;
    border-radius: 20px;
    padding: 28px;
    box-shadow: 0 2px 16px rgba(0,0,0,0.05);
    border: 1.5px solid transparent;
    transition: all 0.3s ease;
    animation: fadeUp 0.6s ease both;
  }

  .question-card:hover {
    border-color: var(--sage-light);
    box-shadow: 0 4px 24px rgba(122,158,135,0.12);
  }

  .question-card.error {
    border-color: #e05a5a !important;
    background: linear-gradient(135deg, white 0%, rgba(224,90,90,0.06) 100%);
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }
  .error-hint {
    font-size: 12px; color: #e05a5a; margin-top: 8px; font-weight: 500;
  }
  .question-card.answered {
    border-color: var(--sage-light);
    background: linear-gradient(135deg, white 0%, rgba(200,221,208,0.15) 100%);
  }

  .question-number {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--sage);
    margin-bottom: 10px;
  }

  .question-text {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(17px, 3vw, 21px);
    font-weight: 500;
    line-height: 1.5;
    color: var(--charcoal);
    margin-bottom: 20px;
  }

  /* Answer options */
  .options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  @media (max-width: 480px) {
    .options { grid-template-columns: 1fr; }
  }

  .option-label {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    background: var(--cream);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.25s ease;
    border: 1.5px solid transparent;
    user-select: none;
  }

  .option-label:hover {
    background: var(--sage-light);
    border-color: var(--sage);
    transform: translateY(-1px);
  }

  .option-label input[type="radio"] {
    display: none;
  }

  .option-label input[type="radio"]:checked ~ .option-circle {
    background: var(--sage-dark);
    border-color: var(--sage-dark);
  }

  .option-label input[type="radio"]:checked ~ .option-circle::after {
    opacity: 1;
    transform: scale(1);
  }

  .option-label:has(input:checked) {
    background: var(--sage-light);
    border-color: var(--sage-dark);
  }

  .option-circle {
    width: 20px; height: 20px;
    min-width: 20px;
    border-radius: 50%;
    border: 2px solid var(--sage-light);
    background: white;
    position: relative;
    transition: all 0.2s ease;
  }

  .option-circle::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 8px; height: 8px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    transition: all 0.2s ease;
  }

  .option-score {
    font-size: 12px;
    font-weight: 500;
    color: var(--sage-dark);
    background: white;
    border-radius: 6px;
    padding: 2px 7px;
    margin-left: auto;
    opacity: 0.7;
  }

  .option-text {
    font-size: 14px;
    line-height: 1.4;
    color: var(--charcoal);
    flex: 1;
  }

  /* Submit */
  .submit-wrap {
    margin-top: 40px;
    text-align: center;
    animation: fadeUp 0.6s 0.3s ease both;
  }

  .submit-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: var(--sage-dark);
    color: white;
    border: none;
    padding: 18px 48px;
    border-radius: 50px;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 0.02em;
    box-shadow: 0 4px 20px rgba(74,112,89,0.3);
  }

  .submit-btn:hover {
    background: var(--sage);
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(74,112,89,0.35);
  }

  .submit-btn:disabled {
    background: var(--sage-light);
    color: var(--muted);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .submit-hint {
    margin-top: 12px;
    font-size: 13px;
    color: var(--muted);
  }

  /* Result screen */
  .result-screen {
    display: none;
    text-align: center;
    animation: fadeUp 0.8s ease both;
  }

  .result-screen.visible { display: block; }

  .result-icon {
    width: 80px; height: 80px;
    background: var(--sage-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    font-size: 36px;
  }

  .result-screen h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 32px;
    font-weight: 500;
    margin-bottom: 12px;
  }

  .result-score-display {
    font-size: 72px;
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
    color: var(--sage-dark);
    line-height: 1;
    margin: 24px 0 8px;
  }

  .result-max {
    font-size: 16px;
    color: var(--muted);
    margin-bottom: 24px;
  }

  .result-interpretation {
    background: white;
    border-radius: 16px;
    padding: 24px 32px;
    margin: 24px 0;
    border-left: 3px solid var(--accent);
    text-align: left;
    box-shadow: 0 2px 16px rgba(0,0,0,0.05);
  }

  .result-interpretation .level {
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 8px;
  }

  .result-interpretation p {
    font-size: 15px;
    line-height: 1.7;
    color: var(--charcoal);
  }

  .result-note {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
    margin-top: 20px;
  }

  /* Animations */
  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .question-card:nth-child(1) { animation-delay: 0.05s; }
  .question-card:nth-child(2) { animation-delay: 0.1s; }
  .question-card:nth-child(3) { animation-delay: 0.15s; }
  .question-card:nth-child(4) { animation-delay: 0.2s; }
  .question-card:nth-child(5) { animation-delay: 0.25s; }
  .question-card:nth-child(6) { animation-delay: 0.3s; }
  .question-card:nth-child(7) { animation-delay: 0.35s; }
  .question-card:nth-child(8) { animation-delay: 0.4s; }
  .question-card:nth-child(9) { animation-delay: 0.45s; }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <div class="header">
    <div class="logo-line">
      <div class="logo-dot"></div>
      <span class="logo-name">Психолог Ольга Луспеник</span>
      <div class="logo-dot"></div>
    </div>
    <div style="font-size:13px;color:var(--muted);letter-spacing:0.08em;margin-bottom:10px;">КПТ · Схема-терапія · Бодинаміка</div>
    <div style="font-size:14px;color:var(--sage-dark);margin-bottom:20px;letter-spacing:0.03em;">«Зміни починаються з маленьких кроків»</div>
    <h1>Опитувальник<br><em>стану здоров'я</em></h1>
    <p>PHQ-9 · Шкала для оцінки рівня депресії</p>
  </div>

  <!-- Form -->
  <div id="formSection">
    <!-- Progress -->
    <div class="progress-wrap">
      <div class="progress-header">
        <span class="progress-label">Прогрес</span>
        <span class="progress-count" id="progressCount">0 з 9</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <!-- Instruction -->
    <div class="instruction-card">
      <p>Протягом <strong>останніх двох тижнів</strong> як часто вас турбували наступні проблеми? Оберіть один варіант відповіді для кожного питання.</p>
    </div>

    <!-- Questions -->
    <div class="questions-list" id="questionsList"></div>

    <!-- Submit -->
    <div class="submit-wrap">
      <div style="background:white;border-radius:16px;padding:24px;margin-bottom:16px;box-shadow:0 2px 16px rgba(0,0,0,0.05);">
        <p style="font-size:13px;color:var(--muted);margin-bottom:16px;">Будь ласка, заповніть перед відправкою:</p>
        <input id="clientFullName" type="text" placeholder="Ваше ім'я та прізвище" maxlength="100"
          style="width:100%;padding:14px 20px;border:1.5px solid var(--sage-light);border-radius:12px;
          font-family:'DM Sans',sans-serif;font-size:15px;background:var(--cream);color:var(--charcoal);
          outline:none;margin-bottom:12px;box-sizing:border-box;">
        <input id="clientDOB" type="text" placeholder="Дата народження (наприклад: 15.03.1990)" maxlength="20"
          style="width:100%;padding:14px 20px;border:1.5px solid var(--sage-light);border-radius:12px;
          font-family:'DM Sans',sans-serif;font-size:15px;background:var(--cream);color:var(--charcoal);
          outline:none;box-sizing:border-box;">
      </div>
      <button class="submit-btn" id="submitBtn" disabled onclick="submitForm()">
        <span>Надіслати результати</span>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </button>
      <div class="submit-hint" id="submitHint">Заповніть усі 9 питань</div>
    </div>
  </div>

  <!-- Result screen -->
  <div class="result-screen" id="resultScreen">
    <div class="result-icon">✓</div>
    <h2>Дякуємо!</h2>
    <p style="color:var(--muted); font-size:15px;">Ваші відповіді збережено. Результат:</p>
    <div class="result-score-display" id="scoreDisplay">—</div>
    <div class="result-max">балів з 27</div>
    <div class="result-interpretation" id="interpretationBlock">
      <div class="level" id="levelLabel"></div>
      <p id="interpretationText"></p>
    </div>
    <p class="result-note">Ольга отримає повні результати та обговорить їх з вами на наступній зустрічі.</p>
  </div>

</div>

<script>
const questions = [
  "Відсутність інтересу або задоволення від того, що ви робите",
  "Пригніченість, депресія або відчуття безнадійності",
  "Труднощі із засинанням, переривистий сон або, навпаки, надмірна сонливість",
  "Відчуття втоми або нестачі енергії",
  "Відсутність або надмірний апетит",
  "Погане ставлення до себе — відчуття, що ви провалилися в житті або що підвели себе чи свою сім'ю",
  "Труднощі з концентрацією уваги (наприклад, при читанні газети або перегляді телевізора)",
  "Уповільнені рухи або мова, яку помічають інші люди; або навпаки — неспокій, рухова активність більша, ніж зазвичай",
  "Думки про те, що краще б вас не було, або думки про заподіяння собі шкоди"
];

const options = [
  { text: "Жодного разу", score: 0 },
  { text: "Кілька днів", score: 1 },
  { text: "Більше половини днів", score: 2 },
  { text: "Майже щодня", score: 3 }
];

const interpretations = [
  { max: 4,  level: "Мінімальний рівень", text: "Симптоми депресії мінімальні або відсутні. Рекомендується спостереження." },
  { max: 9,  level: "Легкий рівень", text: "Помірно виражені симптоми. Рекомендується спостереження та підтримуюча терапія." },
  { max: 14, level: "Помірний рівень", text: "Виражені симптоми. Рекомендується психотерапія та/або консультація лікаря." },
  { max: 19, level: "Помірно тяжкий рівень", text: "Значно виражені симптоми. Рекомендується активна терапія." },
  { max: 27, level: "Тяжкий рівень", text: "Сильно виражені симптоми. Необхідна негайна комплексна допомога." }
];

let answers = new Array(9).fill(null);

function buildQuestions() {
  const list = document.getElementById('questionsList');
  questions.forEach((q, i) => {
    const card = document.createElement('div');
    card.className = 'question-card';
    card.id = `card-${i}`;

    let optionsHTML = options.map((opt, j) => `
      <label class="option-label">
        <input type="radio" name="q${i}" value="${opt.score}" onchange="onAnswer(${i}, ${opt.score}, this)">
        <div class="option-circle"></div>
        <span class="option-text">${opt.text}</span>
        <span class="option-score">${opt.score}</span>
      </label>
    `).join('');

    card.innerHTML = `
      <div class="question-number">Питання ${i + 1} з ${questions.length}</div>
      <div class="question-text">${q}</div>
      <div class="options">${optionsHTML}</div>
    `;
    list.appendChild(card);
  });
}

function onAnswer(qIndex, score, el) {
  answers[qIndex] = score;
  document.getElementById(`card-${qIndex}`).classList.add('answered');

  const answered = answers.filter(a => a !== null).length;
  document.getElementById('progressCount').textContent = `${answered} з 9`;
  document.getElementById('progressFill').style.width = `${(answered / 9) * 100}%`;

  if (answered === 9) {
    const btn = document.getElementById('submitBtn');
    btn.disabled = false;
    document.getElementById('submitHint').textContent = 'Усі питання заповнено — можна надсилати';
  }
}

function submitForm() {
  // Validate all answered
  let hasError = false;
  document.querySelectorAll('.question-card').forEach((card, i) => {
    if (answers[i] === null) {
      card.classList.add('error');
      card.classList.remove('answered');
      if (!card.querySelector('.error-hint')) {
        const hint = document.createElement('div');
        hint.className = 'error-hint';
        hint.textContent = '⚠ Будь ласка, оберіть відповідь';
        card.appendChild(hint);
      }
      hasError = true;
    } else {
      card.classList.remove('error');
      const hint = card.querySelector('.error-hint');
      if (hint) hint.remove();
    }
  });
  if (hasError) {
    // Scroll to first error
    const first = document.querySelector('.question-card.error');
    if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  const total = answers.reduce((a, b) => a + b, 0);
  const interp = interpretations.find(i => total <= i.max);
  // Ім'я з посилання (передається психологом)
  const urlParams = new URLSearchParams(window.location.search);
  const clientId = urlParams.get('client') || '';
  // Дані які вводить клієнт
  const clientFullName = document.getElementById('clientFullName') ? document.getElementById('clientFullName').value.trim() : '';
  const clientDOB = document.getElementById('clientDOB') ? document.getElementById('clientDOB').value.trim() : '';
  const name = clientId || clientFullName || 'Анонімно';

  document.getElementById('formSection').style.display = 'none';
  const result = document.getElementById('resultScreen');
  result.classList.add('visible');
  document.getElementById('scoreDisplay').textContent = total;
  document.getElementById('levelLabel').textContent = interp.level;
  document.getElementById('interpretationText').textContent = interp.text;

  window.scrollTo({ top: 0, behavior: 'smooth' });

  const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxTaoht8OxwOxxVkfiLGPTiWT36UhWLDqFGCi634STP3uhtMieEg_rSgyc7gNQ3jgdmsQ/exec';
  const payload = {
    timestamp: new Date().toISOString(),
    name: name,
    fullName: clientFullName,
    dob: clientDOB,
    questionnaire: 'PHQ-9',
    score: total,
    level: interp.level,
    answers: answers,
  };
  // Відправка через URL параметри (обходить CSP обмеження GitHub Pages)
  const params = new URLSearchParams({
    data: JSON.stringify(payload)
  });
  const img = new Image();
  img.src = SHEET_URL + '?' + params.toString();
}

buildQuestions();
</script>
</body>
</html>
